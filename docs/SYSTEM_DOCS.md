# æ™ºæ…§åŠå…¬ç©ºé—´ç®¡ç†ç³»ç»Ÿ (SmartOffice) - ç³»ç»Ÿæ–‡æ¡£

## 1. ç³»ç»Ÿæ¦‚è¿°

æ™ºæ…§åŠå…¬ç©ºé—´ç®¡ç†ç³»ç»Ÿï¼ˆSmartOfficeï¼‰æ˜¯ä¸€æ¬¾é¢å‘ç°ä»£åŒ–ä¼ä¸šçš„ç‰©ç†èµ„æºç®¡ç†å¹³å°ã€‚ç³»ç»Ÿé›†æˆäº†ä¼šè®®å®¤é¢„è®¢ã€å·¥ä½ç”³è¯·ã€å¤šçº§å®¡æ‰¹æµç¨‹è‡ªå®šä¹‰ã€ç»„ç»‡æ¶æ„ç®¡ç†ã€åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ä»¥åŠä¼šè®®å®¤å®æ—¶ç›‘æ§å¤§å±ã€‚

### 1.1 ç³»ç»Ÿæ¶æ„

- **å‰ç«¯**: React + TypeScript + Vite
- **UIæ¡†æ¶**: Tailwind CSS + Lucide Icons
- **åç«¯**: Supabase (PostgreSQL + Realtime)
- **éƒ¨ç½²**: æ”¯æŒæœ¬åœ°å¼€å‘å’Œç”Ÿäº§éƒ¨ç½²

---

## 2. ç”¨æˆ·è§’è‰²ä¸æƒé™

ç³»ç»Ÿé‡‡ç”¨åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ï¼Œæ”¯æŒä»¥ä¸‹å››ç§è§’è‰²ï¼š

| è§’è‰² | è¯´æ˜ | æƒé™èŒƒå›´ |
|------|------|----------|
| **ç³»ç»Ÿç®¡ç†å‘˜** (SYSTEM_ADMIN) | æ‹¥æœ‰å…¨ç³»ç»Ÿæœ€é«˜ç®¡ç†æƒé™ | å…¨éƒ¨æƒé™ |
| **å®¡æ‰¹è´Ÿè´£äºº** (APPROVAL_ADMIN) | è´Ÿè´£å„ç±»èµ„æºç”³è¯·çš„ä¸šåŠ¡å®¡æ ¸ | å®¡æ‰¹ä¸­å¿ƒã€é¢„è®¢ç®¡ç†ã€ä¸ªäººä¸­å¿ƒ |
| **ä¼šè®®æœåŠ¡** (MEETING_SERVICE) | è´Ÿè´£ä¼šè®®å®¤æœåŠ¡ç®¡ç† | ä¼šè®®å®¤ç®¡ç†ã€é¢„è®¢æŸ¥çœ‹ã€ä¸ªäººä¸­å¿ƒ |
| **æ™®é€šå‘˜å·¥** (EMPLOYEE) | åŸºæœ¬ä½¿ç”¨æƒé™ | èµ„æºæŸ¥çœ‹ã€é¢„è®¢ã€ä¸ªäººä¸­å¿ƒ |

### 2.1 æƒé™åˆ—è¡¨

```typescript
PERMISSIONS = {
  // åŸºç¡€è§†å›¾æƒé™
  VIEW_DASHBOARD: 'æŸ¥çœ‹ä»ªè¡¨ç›˜',
  VIEW_RESOURCES: 'æŸ¥çœ‹èµ„æº',
  VIEW_MEETING_SERVICE: 'æŸ¥çœ‹ä¼šè®®æœåŠ¡',
  VIEW_APPROVAL_CENTER: 'æŸ¥çœ‹å®¡æ‰¹ä¸­å¿ƒ',
  VIEW_PROFILE: 'æŸ¥çœ‹ä¸ªäººä¸­å¿ƒ',

  // ç®¡ç†æƒé™
  VIEW_BOOKINGS: 'æŸ¥çœ‹é¢„è®¢',
  EDIT_PROFILE: 'ç¼–è¾‘ä¸ªäººèµ„æ–™',
  MANAGE_USERS: 'ç”¨æˆ·ç®¡ç†',
  MANAGE_ROLES: 'è§’è‰²ç®¡ç†',
  MANAGE_DEPARTMENTS: 'éƒ¨é—¨ç®¡ç†',
  MANAGE_RESOURCES: 'èµ„æºç®¡ç†',
  CONFIG_WORKFLOW: 'å·¥ä½œæµé…ç½®',
  ACCESS_DATA_CENTER: 'æ•°æ®ä¸­å¿ƒ',

  // é«˜çº§æƒé™
  VIEW_ALL_BOOKINGS: 'æŸ¥çœ‹æ‰€æœ‰é¢„è®¢',
  APPROVE_BOOKINGS: 'å®¡æ‰¹é¢„è®¢',
  VIEW_ALL_USERS: 'æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·',
  EDIT_ALL_USERS: 'ç¼–è¾‘æ‰€æœ‰ç”¨æˆ·',
}
```

---

## 3. åŠŸèƒ½æ¨¡å—è¯´æ˜

### 3.1 ç”¨æˆ·è®¤è¯ä¸ç™»å½•
- **å¤šæ¸ é“ç™»å½•**: æ”¯æŒä¼ä¸šé‚®ç®±æˆ–æ‰‹æœºå·ç ç™»å½•
- **å¼ºåˆ¶æ”¹å¯†**: åˆæ¬¡ç™»å½•å¿…é¡»ä¿®æ”¹å¯†ç 
- **ä¼šè¯ç®¡ç†**: è‡ªåŠ¨ token åˆ·æ–°

### 3.2 ç»„ç»‡æ¶æ„ç®¡ç†
- **éƒ¨é—¨ç®¡ç†**: æ ‘å½¢ç»“æ„å±•ç¤ºï¼Œæ”¯æŒå¢åˆ æ”¹æŸ¥
- **æ‰¹é‡å¯¼å…¥**: æ”¯æŒ CSV æ ¼å¼å¯¼å…¥ï¼Œè‡ªåŠ¨è¯†åˆ«çˆ¶å­å…³ç³»

### 3.3 èµ„æºç®¡ç†
- **èµ„æºç±»å‹**: ä¼šè®®å®¤ã€å·¥ä½ã€è®¾å¤‡ç­‰
- **å±æ€§é…ç½®**: åç§°ã€å®¹é‡ã€ä½ç½®ã€ç‰¹æ€§æ ‡ç­¾
- **çŠ¶æ€ç®¡ç†**: å¯ç”¨ã€ä¸å¯ç”¨ã€ç»´æŠ¤ä¸­

### 3.4 é¢„è®¢ç³»ç»Ÿ
- **é¢„è®¢ç”³è¯·**: é€‰æ‹©èµ„æºã€æ—¶é—´ã€å‚ä¼šäººæ•°ã€ç”¨é€”
- **å¤šçº§å®¡æ‰¹**: å¯é…ç½®å®¡æ‰¹å·¥ä½œæµ
- **çŠ¶æ€è·Ÿè¸ª**: å¾…å®¡æ‰¹ã€å·²ç¡®è®¤ã€å·²æ‹’ç»ã€å·²å–æ¶ˆ

### 3.5 å®¡æ‰¹ä¸­å¿ƒ
- **å¾…å®¡æ‰¹åˆ—è¡¨**: æ˜¾ç¤ºéœ€è¦å®¡æ‰¹çš„é¢„è®¢
- **æ‰¹é‡å®¡æ‰¹**: æ”¯æŒé€šè¿‡/æ‹’ç»æ“ä½œ
- **å®¡æ‰¹å†å²**: æŸ¥çœ‹å®¡æ‰¹è®°å½•

### 3.6 ä¼šè®®å®¤ç›‘æ§å¤§å± (æ–°å¢)
- **å®æ—¶æ•°æ®**: é€šè¿‡ Supabase Realtime å®æ—¶æ¨é€
- **è½®è¯¢å¤‡ä»½**: 30 ç§’è‡ªåŠ¨åˆ·æ–°ï¼ˆå½“å®æ—¶æ¨é€ä¸å¯ç”¨æ—¶ï¼‰
- **æ—¶é—´æ ¼è§†å›¾**: å¯è§†åŒ–å±•ç¤ºä»Šæ—¥ä¼šè®®å®¤ä½¿ç”¨æƒ…å†µ
- **çŠ¶æ€é¢œè‰²åŒºåˆ†**:
  - ğŸŸ¢ ç»¿è‰² - è¿›è¡Œä¸­
  - ğŸŸ¢ æµ…ç»¿ - å³å°†å¼€å§‹
  - âš« ç°è‰² - å·²ç»“æŸï¼ˆåŠé€æ˜ï¼‰
  - ğŸŸ¡ é»„è‰² - å¾…å®¡æ‰¹
  - â¬› æ·±ç° - ç©ºé—²
- **å‘¨è§†å›¾**: å±•ç¤ºæœ¬å‘¨é¢„è®¢æ¦‚è§ˆ
- **ç»Ÿè®¡æ•°æ®**: ä»Šæ—¥é¢„è®¢æ•°ã€æ€»æ—¶é•¿ã€è¿›è¡Œä¸­ä¼šè®®ã€æœ¬å‘¨æ€»æ•°

---

## 4. ç›‘æ§å¤§å±ä½¿ç”¨è¯´æ˜

### 4.1 è®¿é—®ç›‘æ§å¤§å±

ç›‘æ§å¤§å±å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š
- ç›´æ¥è®¿é—® `/monitor.html` æˆ–é…ç½®ç‹¬ç«‹å…¥å£

### 4.2 åŠŸèƒ½è¯´æ˜

1. **é¡¶éƒ¨çŠ¶æ€æ **
   - å±…ä¸­æ˜¾ç¤ºè¿æ¥çŠ¶æ€ï¼ˆå®æ—¶è¿æ¥/è¿æ¥ä¸­/å·²æ–­å¼€ï¼‰
   - æ˜¾ç¤ºæ•°æ®æ›´æ–°ç»Ÿè®¡ï¼ˆæ–°å¢/æ›´æ–°/åˆ é™¤ï¼‰
   - æ‰‹åŠ¨åˆ·æ–°æŒ‰é’®

2. **ç»Ÿè®¡å¡ç‰‡**ï¼ˆé¡¶éƒ¨ï¼‰
   - ä»Šæ—¥é¢„è®¢ä¼šè®®æ•°
   - ä»Šæ—¥é¢„è®¢æ€»æ—¶é•¿
   - æ­£åœ¨è¿›è¡Œä¼šè®®æ•°
   - æœ¬å‘¨é¢„è®¢æ€»æ•°

3. **æ—¶é—´æ ¼è§†å›¾**ï¼ˆä¸»åŒºåŸŸï¼‰
   - æ¨ªè½´ï¼š7:00-21:00 æ—¶é—´æ®µ
   - çºµè½´ï¼šå„ä¼šè®®å®¤
   - è‰²å—ï¼šè¡¨ç¤ºé¢„è®¢æ—¶æ®µ
   - æ‚¬åœï¼šæ˜¾ç¤ºé¢„è®¢è¯¦æƒ…

4. **å‘¨è§†å›¾**ï¼ˆåº•éƒ¨ï¼‰
   - å±•ç¤ºæœªæ¥7å¤©æ¯å¤©çš„é¢„è®¢æ¦‚è§ˆ
   - ç‚¹å‡»æ—¥æœŸå¯æŸ¥çœ‹è¯¦ç»†

### 4.3 é¢œè‰²å«ä¹‰

| çŠ¶æ€ | é¢œè‰² | è¯´æ˜ |
|------|------|------|
| è¿›è¡Œä¸­ | ç»¿è‰²æ·±è‰² | ä¼šè®®æ­£åœ¨è¿›è¡Œ |
| å³å°†å¼€å§‹ | ç»¿è‰²æµ…è‰² | ä¼šè®®å°†åœ¨è¿‘æœŸå¼€å§‹ |
| å·²ç»“æŸ | ç°è‰²ï¼ˆåŠé€æ˜ï¼‰ | ä¼šè®®å·²ç»“æŸ |
| å¾…å®¡æ‰¹ | é»„è‰² | ç­‰å¾…å®¡æ‰¹ |
| ç©ºé—² | æ·±ç°è‰² | æ— é¢„è®¢ |

---

## 5. æŠ€æœ¯å®ç°

### 5.1 å®æ—¶æ•°æ®æ¨é€

```typescript
// å®æ—¶æœåŠ¡é…ç½®
createRealtimeService({
  onBookingsChange: (bookings, delta) => { ... },
  onResourcesChange: (resources, delta) => { ... },
  onConnectionChange: (status) => { ... },
});
```

### 5.2 æ•°æ®è½¬æ¢

æ•°æ®åº“å­—æ®µï¼ˆsnake_caseï¼‰â†’ åº”ç”¨å­—æ®µï¼ˆcamelCaseï¼‰:

```typescript
transformBookingFromDB({
  start_time: '2024-01-01T09:00:00Z',
  end_time: '2024-01-01T10:00:00Z',
  resource_id: 'xxx',
  // â†’ è½¬æ¢ä¸º
  startTime: '2024-01-01T09:00:00Z',
  endTime: '2024-01-01T10:00:00Z',
  resourceId: 'xxx',
})
```

### 5.3 æ—¶åŒºå¤„ç†

- ç»Ÿä¸€ä½¿ç”¨æœ¬åœ°æ—¶åŒºæ˜¾ç¤º
- æ—¥æœŸæ¯”è¾ƒä½¿ç”¨ `getLocalDateStr()` å‡½æ•°
- æ—¶é—´æ¯”è¾ƒä½¿ç”¨ `getHours()` è€Œé `getUTCHours()`

---

## 6. éƒ¨ç½²é…ç½®

### 6.1 ç¯å¢ƒå˜é‡

```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_GEMINI_API_KEY=your-gemini-api-key
```

### 6.2 Supabase é…ç½®

1. å¯ç”¨æ•°æ®åº“ Realtime
2. é…ç½® RLS ç­–ç•¥
3. è®¾ç½®å¥½è¡¨æƒé™

---

## 7. å¸¸è§é—®é¢˜

### Q1: ç›‘æ§å¤§å±ä¸æ˜¾ç¤ºæ•°æ®
- æ£€æŸ¥ Supabase è¿æ¥æ˜¯å¦æ­£å¸¸
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—

### Q2: å®æ—¶æ¨é€ä¸å·¥ä½œ
- ç¡®è®¤å·²åœ¨ Supabase æ§åˆ¶å°å¯ç”¨ Realtime
- æ£€æŸ¥æ•°æ®åº“è¡¨çš„å¤åˆ¶è®¾ç½®

### Q3: æ—¶é—´æ˜¾ç¤ºä¸æ­£ç¡®
- æ£€æŸ¥æ—¶åŒºè®¾ç½®
- ç¡®ä¿ä½¿ç”¨æœ¬åœ°æ—¶é—´è€Œé UTC

---

*æœ€åæ›´æ–°: 2024*
